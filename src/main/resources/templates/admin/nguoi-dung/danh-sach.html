<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="admin/admin-layout :: head('Quản lý người dùng')"></head>
<body>
<aside th:replace="admin/admin-layout :: sidebar('nguoi-dung')"></aside>

<main class="main-content">
    <div th:replace="admin/admin-layout :: header('Quản lý người dùng', 'fas fa-users')"></div>

    <!-- Alert -->
    <div class="alert alert-success" th:if="${message}" style="margin-bottom: 20px;">
        <i class="fas fa-check-circle"></i> <span th:text="${message}"></span>
    </div>

    <!-- Statistics Cards -->
    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-bottom: 25px;">
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px;">
            <div style="font-size: 13px; opacity: 0.9; margin-bottom: 8px;">Tổng users</div>
            <div style="font-size: 28px; font-weight: 700;" th:text="${totalUsers}">0</div>
        </div>
        <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 10px;">
            <div style="font-size: 13px; opacity: 0.9; margin-bottom: 8px;">Admin</div>
            <div style="font-size: 28px; font-weight: 700;" th:text="${totalAdmin}">0</div>
        </div>
        <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 10px;">
            <div style="font-size: 13px; opacity: 0.9; margin-bottom: 8px;">Khách hàng</div>
            <div style="font-size: 28px; font-weight: 700;" th:text="${totalKhachHang}">0</div>
        </div>
        <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; padding: 20px; border-radius: 10px;">
            <div style="font-size: 13px; opacity: 0.9; margin-bottom: 8px;">Đang hoạt động</div>
            <div style="font-size: 28px; font-weight: 700;" th:text="${totalActive}">0</div>
        </div>
        <div style="background: linear-gradient(135deg, #ff6b6b 0%, #ff8787 100%); color: white; padding: 20px; border-radius: 10px;">
            <div style="font-size: 13px; opacity: 0.9; margin-bottom: 8px;">Vô hiệu hóa</div>
            <div style="font-size: 28px; font-weight: 700;" th:text="${totalInactive}">0</div>
        </div>
    </div>

    <!-- Filters -->
    <div class="content-section" style="margin-bottom: 20px;">
        <!-- Search Form -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <form th:action="@{/admin/nguoi-dung}" method="get" style="flex: 1; display: flex; gap: 10px; margin-right: 15px;">
                <input type="text" name="keyword" th:value="${keyword}" placeholder="Tìm theo tên, email, SĐT..."
                       style="flex: 1; padding: 10px 15px; border: 2px solid #e0e0e0; border-radius: 8px;">
                <button type="submit" class="btn btn-primary"><i class="fas fa-search"></i> Tìm</button>
                <a href="/admin/nguoi-dung" class="btn btn-secondary" th:if="${keyword}"><i class="fas fa-times"></i></a>
            </form>
            <a href="/admin/nguoi-dung/them" class="btn btn-success">
                <i class="fas fa-plus"></i> Thêm người dùng
            </a>
        </div>

        <!-- THÊM: Filter Buttons -->
        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            <a href="/admin/nguoi-dung" class="filter-btn"
               th:classappend="${vaiTro == null} ? 'active' : ''">
                Tất cả
            </a>
            <a th:href="@{/admin/nguoi-dung(vaiTro='admin')}" class="filter-btn"
               th:classappend="${vaiTro == 'admin'} ? 'active' : ''">
                <i class="fas fa-user-shield"></i> Admin
            </a>
            <a th:href="@{/admin/nguoi-dung(vaiTro='khach_hang')}" class="filter-btn"
               th:classappend="${vaiTro == 'khach_hang'} ? 'active' : ''">
                <i class="fas fa-user"></i> Khách hàng
            </a>
        </div>
    </div>

    <!-- Users Table -->
    <div class="content-section">
        <table style="width: 100%; border-collapse: collapse;">
            <thead style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <tr>
                <th style="padding: 14px 10px; text-align: left; width: 60px;">ID</th>
                <th style="padding: 14px 10px; text-align: left; width: 180px;">Họ tên</th>
                <th style="padding: 14px 10px; text-align: left;">Email</th>
                <th style="padding: 14px 10px; text-align: left; width: 130px;">SĐT</th>
                <th style="padding: 14px 10px; text-align: left; width: 150px;">Mật khẩu</th>
                <th style="padding: 14px 10px; text-align: center; width: 120px;">Vai trò</th>
                <th style="padding: 14px 10px; text-align: center; width: 130px;">Trạng thái</th>
                <th style="padding: 14px 10px; text-align: center; width: 180px;">Thao tác</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="nd : ${nguoiDungPage.content}" style="border-bottom: 1px solid #f0f0f0;">
                <td style="padding: 15px 10px;">
                    <span style="font-weight: 600; color: #667eea;" th:text="${nd.id}">1</span>
                </td>
                <td style="padding: 15px 10px;">
                    <div style="font-weight: 600; color: #333;" th:text="${nd.hoTen}">Nguyễn Văn A</div>
                </td>
                <td style="padding: 15px 10px;">
                    <span style="color: #666;" th:text="${nd.email}">email@example.com</span>
                </td>
                <td style="padding: 15px 10px;">
                    <span style="color: #666;" th:text="${nd.sdt}">0123456789</span>
                </td>
                <td style="padding: 15px 10px;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <input th:id="'pwd-' + ${nd.id}" type="password" th:value="${nd.matKhau}" readonly
                               style="width: 100px; padding: 6px 10px; border: 1px solid #e0e0e0; border-radius: 6px; background: #f8f9fa; font-size: 12px;">
                        <button th:onclick="'togglePassword(' + ${nd.id} + ')'"
                                style="width: 32px; height: 32px; display: inline-flex; align-items: center; justify-content: center; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;"
                                title="Hiện/Ẩn mật khẩu">
                            <i class="fas fa-eye" th:id="'eye-' + ${nd.id}"></i>
                        </button>
                    </div>
                </td>
                <td style="padding: 15px 10px; text-align: center;">
                    <th:block th:switch="${nd.vaiTro.name()}">
                        <span th:case="'admin'" class="status-badge badge-danger">Admin</span>
                        <span th:case="'khach_hang'" class="status-badge badge-info">Khách hàng</span>
                    </th:block>
                </td>
                <td style="padding: 15px 10px; text-align: center;">
                    <th:block th:switch="${nd.trangThai.name()}">
                        <span th:case="'active'" class="status-badge badge-success">Hoạt động</span>
                        <span th:case="'inactive'" class="status-badge badge-warning">Vô hiệu</span>
                    </th:block>
                </td>
                <td style="padding: 15px 10px; text-align: center;">
                    <div style="display: flex; gap: 5px; justify-content: center;">
                        <a th:href="@{'/admin/nguoi-dung/chi-tiet/' + ${nd.id}}"
                           style="width: 34px; height: 34px; display: inline-flex; align-items: center; justify-content: center; background: #667eea; color: white; border-radius: 6px; text-decoration: none;"
                           title="Xem chi tiết">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a th:href="@{'/admin/nguoi-dung/sua/' + ${nd.id}}"
                           style="width: 34px; height: 34px; display: inline-flex; align-items: center; justify-content: center; background: #4caf50; color: white; border-radius: 6px; text-decoration: none;"
                           title="Sửa">
                            <i class="fas fa-edit"></i>
                        </a>
                        <form th:action="@{'/admin/nguoi-dung/xoa/' + ${nd.id}}" method="post"
                              onsubmit="return confirm('⚠️ Bạn có chắc muốn xóa người dùng này?')"
                              style="display: inline;">
                            <button type="submit"
                                    style="width: 34px; height: 34px; display: inline-flex; align-items: center; justify-content: center; background: #f44336; color: white; border-radius: 6px; border: none; cursor: pointer;"
                                    title="Xóa">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>

        <!-- Empty State -->
        <div th:if="${nguoiDungPage.content.isEmpty()}" style="text-align: center; padding: 60px 20px; color: #999;">
            <i class="fas fa-users" style="font-size: 64px; margin-bottom: 20px; opacity: 0.3;"></i>
            <h3>Chưa có người dùng nào</h3>
        </div>

        <!-- Pagination -->
        <div th:if="${nguoiDungPage.totalPages > 1}" style="display: flex; justify-content: center; gap: 8px; margin-top: 30px; padding: 20px;">
            <a th:if="${nguoiDungPage.number > 0}"
               th:href="@{/admin/nguoi-dung(page=${nguoiDungPage.number - 1}, keyword=${keyword}, vaiTro=${vaiTro})}"
               style="min-width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; background: white; border: 2px solid #e0e0e0; border-radius: 8px; color: #667eea; text-decoration: none;">
                <i class="fas fa-chevron-left"></i>
            </a>
            <span th:each="i : ${#numbers.sequence(0, nguoiDungPage.totalPages - 1)}"
                  th:if="${i >= nguoiDungPage.number - 2 and i <= nguoiDungPage.number + 2}">
                <a th:href="@{/admin/nguoi-dung(page=${i}, keyword=${keyword}, vaiTro=${vaiTro})}"
                   th:class="${i == nguoiDungPage.number} ? 'page-active' : 'page-link'"
                   th:text="${i + 1}">1</a>
            </span>
            <a th:if="${nguoiDungPage.number < nguoiDungPage.totalPages - 1}"
               th:href="@{/admin/nguoi-dung(page=${nguoiDungPage.number + 1}, keyword=${keyword}, vaiTro=${vaiTro})}"
               style="min-width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; background: white; border: 2px solid #e0e0e0; border-radius: 8px; color: #667eea; text-decoration: none;">
                <i class="fas fa-chevron-right"></i>
            </a>
        </div>
    </div>
</main>

<script>
    function togglePassword(id) {
        const input = document.getElementById('pwd-' + id);
        const icon = document.getElementById('eye-' + id);

        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            input.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    }
</script>

<style>
    .filter-btn {
        padding: 10px 16px;
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        color: #666;
        text-decoration: none;
        font-size: 13px;
        font-weight: 600;
        transition: all 0.3s;
        white-space: nowrap;
    }

    .filter-btn:hover {
        border-color: #667eea;
        color: #667eea;
    }

    .filter-btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: #667eea;
    }

    .page-link, .page-active {
        min-width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center;
        border: 2px solid #e0e0e0; border-radius: 8px; font-weight: 600; text-decoration: none;
    }
    .page-link { background: white; color: #667eea; }
    .page-active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-color: #667eea; }
</style>
</body>
</html>