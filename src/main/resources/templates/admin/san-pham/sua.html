<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="admin/admin-layout :: head('Sửa sản phẩm')"></head>
<body>
<!-- Sidebar -->
<aside th:replace="admin/admin-layout :: sidebar('san-pham')"></aside>

<!-- Main Content -->
<main class="main-content">
    <!-- Header -->
    <div th:replace="admin/admin-layout :: header('Sửa sản phẩm', 'fas fa-edit')"></div>

    <!-- Alert Messages -->
    <div class="alert alert-error" th:if="${error}">
        <i class="fas fa-exclamation-circle"></i>
        <span th:text="${error}">Lỗi</span>
    </div>

    <!-- Form -->
    <div class="content-section">
        <form th:action="@{'/admin/san-pham/sua/' + ${sanPham.id}}" method="post">
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
                <!-- Left Column -->
                <div>
                    <h3 style="margin-bottom: 20px; color: #333;">Thông tin cơ bản</h3>

                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                            Tên sản phẩm <span style="color: #ff6b6b;">*</span>
                        </label>
                        <input type="text" name="ten" required th:value="${sanPham.ten}"
                               placeholder="Nhập tên sản phẩm"
                               style="width: 100%; padding: 10px 15px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                            Mô tả
                        </label>
                        <textarea name="moTa" rows="5" th:text="${sanPham.moTa}"
                                  placeholder="Mô tả chi tiết về sản phẩm..."
                                  style="width: 100%; padding: 10px 15px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; resize: vertical;"></textarea>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                                Giá (₫) <span style="color: #ff6b6b;">*</span>
                            </label>
                            <input type="number" name="gia" required min="0" step="1000" th:value="${sanPham.gia}"
                                   style="width: 100%; padding: 10px 15px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                                Số lượng tồn <span style="color: #ff6b6b;">*</span>
                            </label>
                            <input type="number" name="soLuongTon" required min="0" th:value="${sanPham.soLuongTon}"
                                   style="width: 100%; padding: 10px 15px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                                Danh mục <span style="color: #ff6b6b;">*</span>
                            </label>
                            <select name="danhMucId" required
                                    style="width: 100%; padding: 10px 15px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                                <option value="">-- Chọn danh mục --</option>
                                <option th:each="dm : ${danhMucList}"
                                        th:value="${dm.id}"
                                        th:text="${dm.ten}"
                                        th:selected="${dm.id == sanPham.danhMucId}">Danh mục</option>
                            </select>
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                                Tác giả
                            </label>
                            <select name="tacGiaId"
                                    style="width: 100%; padding: 10px 15px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                                <option value="">-- Không có --</option>
                                <option th:each="tg : ${tacGiaList}"
                                        th:value="${tg.id}"
                                        th:text="${tg.ten}"
                                        th:selected="${tg.id == sanPham.tacGiaId}">Tác giả</option>
                            </select>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                            Trạng thái <span style="color: #ff6b6b;">*</span>
                        </label>
                        <select name="trangThai" required
                                style="width: 100%; padding: 10px 15px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                            <option value="con_hang" th:selected="${sanPham.trangThai == T(com.nvkproject3.model.SanPham.TrangThai).con_hang}">Còn hàng</option>
                            <option value="het_hang" th:selected="${sanPham.trangThai == T(com.nvkproject3.model.SanPham.TrangThai).het_hang}">Hết hàng</option>
                            <option value="ngung_kinh_doanh" th:selected="${sanPham.trangThai == T(com.nvkproject3.model.SanPham.TrangThai).ngung_kinh_doanh}">Ngừng kinh doanh</option>
                        </select>
                    </div>

                    <h3 style="margin: 30px 0 20px; color: #333;">Thông tin chi tiết</h3>

                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                            Nhà xuất bản
                        </label>
                        <input type="text" name="nhaXuatBan" th:value="${sanPham.nhaXuatBan}"
                               style="width: 100%; padding: 10px 15px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                                Năm xuất bản
                            </label>
                            <input type="number" name="namXuatBan" min="1900" max="2100" th:value="${sanPham.namXuatBan}"
                                   style="width: 100%; padding: 10px 15px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                                Số trang
                            </label>
                            <input type="number" name="soTrang" min="1" th:value="${sanPham.soTrang}"
                                   style="width: 100%; padding: 10px 15px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div>
                    <h3 style="margin-bottom: 20px; color: #333;">Hình ảnh</h3>

                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
                            URL hình đại diện
                        </label>
                        <input type="url" name="anhDaiDien" id="anhDaiDien" th:value="${sanPham.anhDaiDien}"
                               placeholder="https://example.com/image.jpg"
                               style="width: 100%; padding: 10px 15px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                    </div>

                    <div id="imagePreview" th:style="${sanPham.anhDaiDien != null and !sanPham.anhDaiDien.isEmpty()} ? 'display: block;' : 'display: none;'">
                        <img id="previewImg" th:src="${sanPham.anhDaiDien}" alt="Preview"
                             style="width: 100%; border-radius: 8px; border: 2px solid #e0e0e0;">
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #f0f0f0; display: flex; gap: 10px; justify-content: flex-end;">
                <a href="/admin/san-pham" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Hủy
                </a>
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i> Cập nhật
                </button>
            </div>
        </form>
    </div>
</main>

<script>
    // Preview image
    document.getElementById('anhDaiDien').addEventListener('input', function() {
        const url = this.value;
        const preview = document.getElementById('imagePreview');
        const img = document.getElementById('previewImg');

        if (url) {
            img.src = url;
            preview.style.display = 'block';

            img.onerror = function() {
                preview.style.display = 'none';
            };
        } else {
            preview.style.display = 'none';
        }
    });
</script>
</body>
</html>